<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Blox Bux</title>
<link rel="stylesheet" href="style.css">
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
import { getFirestore, collection, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

// ===== CONFIG =====
const firebaseConfig = {
  apiKey: "AIzaSyC3wm5X7fBXjC8hUQv4sRdHS-v74KWIBC4",
  authDomain: "blox-bux.firebaseapp.com",
  databaseURL: "https://blox-bux-default-rtdb.firebaseio.com",
  projectId: "blox-bux",
  storageBucket: "blox-bux.appspot.com",
  messagingSenderId: "2964601609",
  appId: "1:2964601609:web:67ee85c8174825aee471d8",
  measurementId: "G-W2BW6GDCSY"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// VERIFICAR LOGIN
onAuthStateChanged(auth, user => {
  if(!user) { window.location.href = "login.html"; return; }
  document.getElementById("user-name").innerText = user.displayName || user.email;
  document.getElementById("user-email").innerText = user.email;
  if(user.email === "marymartins5821@gmail.com") {
    document.getElementById("admin-btn").style.display = "block";
  }
});

// LOGOUT
document.getElementById("logout").addEventListener("click", async () => {
  await signOut(auth);
  window.location.href = "login.html";
});

// ABAS
function showTab(tab) {
  document.querySelectorAll(".tab-content").forEach(c => c.style.display = "none");
  document.getElementById(tab).style.display = "block";
}
document.getElementById("tab-account").addEventListener("click", () => showTab("account"));
document.getElementById("tab-products").addEventListener("click", () => showTab("products"));

// CARREGAR PRODUTOS
async function carregarProdutos() {
  const lista = document.getElementById("products-list");
  lista.innerHTML = "";
  const snapshot = await getDocs(collection(db, "produtos"));
  snapshot.forEach(doc => {
    const produto = doc.data();
    lista.innerHTML += `
      <div class="product-card">
        <div class="product-info">
          <h3>${produto.nome}</h3>
          <p>R$ ${produto.preco}</p>
        </div>
        <a href="https://wa.me/5548996354447?text=Quero%20comprar%20${encodeURIComponent(produto.nome)}%20por%20R$${produto.preco}">
          <button class="buy-btn">Comprar</button>
        </a>
      </div>
    `;
  });
}
carregarProdutos();

// PAINEL ADMIN
document.getElementById("admin-btn").addEventListener("click", () => {
  document.getElementById("admin-section").classList.toggle("show-admin");
});

// ADICIONAR PRODUTO
document.getElementById("product-form").addEventListener("submit", async (e) => {
  e.preventDefault();
  const nome = document.getElementById("product-name").value;
  const preco = document.getElementById("product-price").value;
  await addDoc(collection(db, "produtos"), { nome, preco });
  alert("Produto adicionado!");
  e.target.reset();
  carregarProdutos();
});
</script>
</head>
<body class="main-body">
<header>
  <h1>Blox Bux</h1>
  <button id="logout">Sair</button>
</header>

<div class="tabs">
  <button id="tab-account" class="tab-btn active">Minha Conta</button>
  <button id="tab-products" class="tab-btn">Produtos</button>
  <button id="admin-btn" style="display:none;">Admin</button>
</div>

<!-- ABAS -->
<div id="account" class="tab-content">
  <h2>Minha Conta</h2>
  <p>Nome: <span id="user-name"></span></p>
  <p>Email: <span id="user-email"></span></p>
</div>

<div id="products" class="tab-content" style="display:none;">
  <h2>Produtos</h2>
  <div id="products-list" class="product-list"></div>
</div>

<!-- PAINEL ADMIN -->
<div id="admin-section" class="admin-panel">
  <h2>Painel Admin</h2>
  <form id="product-form">
    <input id="product-name" placeholder="Nome do Produto" required><br><br>
    <input id="product-price" type="number" placeholder="PreÃ§o" required><br><br>
    <button type="submit">Adicionar Produto</button>
  </form>
</div>
</body>
</html>
