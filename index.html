<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blox Bux - Loja</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>Blox Bux</h1>
    <nav>
      <button id="logoutBtn" style="display:none;">Sair</button>
      <button id="adminBtn" style="display:none;" onclick="toggleAdminPanel()">Painel Admin</button>
    </nav>
  </header>

  <aside class="sidebar">
    <h2>Perfil</h2>
    <p id="userEmail">Não logado</p>
  </aside>

  <main>
    <section id="productsContainer" class="products"></section>

    <section id="adminPanel" style="display:none;">
      <h2>Painel de Administração</h2>
      <form id="addProductForm">
        <input type="text" id="productName" placeholder="Nome do Produto" required>
        <input type="text" id="productPrice" placeholder="Preço" required>
        <input type="text" id="productImage" placeholder="URL da Imagem" required>
        <button type="submit">Adicionar Produto</button>
      </form>
    </section>
  </main>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js"></script>

  <script>
    // Configuração Firebase
    const firebaseConfig = {
      apiKey: "SUA_API_KEY",
      authDomain: "blox-bux.firebaseapp.com",
      databaseURL: "https://blox-bux-default-rtdb.firebaseio.com",
      projectId: "blox-bux",
      storageBucket: "blox-bux.appspot.com",
      messagingSenderId: "2964601609",
      appId: "1:2964601609:web:67ee85c8174825aee471d8",
    };

    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    // Lista de administradores
    const admins = ["marymartins5821@gmail.com", "jp9877475@gmail.com"];

    const logoutBtn = document.getElementById("logoutBtn");
    const adminBtn = document.getElementById("adminBtn");
    const adminPanel = document.getElementById("adminPanel");
    const userEmail = document.getElementById("userEmail");
    const productsContainer = document.getElementById("productsContainer");
    const addProductForm = document.getElementById("addProductForm");

    // Controle de login
    auth.onAuthStateChanged(user => {
      if (user) {
        userEmail.textContent = user.email;
        logoutBtn.style.display = "inline-block";

        if (admins.includes(user.email)) {
          adminBtn.style.display = "inline-block";
        }

        carregarProdutos();
      } else {
        window.location.href = "login.html";
      }
    });

    logoutBtn.addEventListener("click", () => {
      auth.signOut();
    });

    function toggleAdminPanel() {
      if (auth.currentUser && admins.includes(auth.currentUser.email)) {
        adminPanel.style.display = adminPanel.style.display === "none" ? "block" : "none";
      } else {
        alert("Apenas administradores podem acessar!");
      }
    }

    // Adicionar produto
    addProductForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const name = document.getElementById("productName").value;
      const price = document.getElementById("productPrice").value;
      const image = document.getElementById("productImage").value;

      const newProductRef = db.ref("products").push();
      newProductRef.set({
        name, price, image
      }).then(() => {
        addProductForm.reset();
      }).catch(err => alert("Erro: " + err.message));
    });

    // Carregar produtos
    function carregarProdutos() {
      db.ref("products").on("value", snapshot => {
        productsContainer.innerHTML = "";
        snapshot.forEach(child => {
          const product = child.val();
          const productId = child.key;

          const productCard = document.createElement("div");
          productCard.classList.add("product-card");
          productCard.innerHTML = `
            <img src="${product.image}" alt="${product.name}">
            <h3>${product.name}</h3>
            <p>Preço: R$ ${product.price}</p>
            <a href="https://wa.me/5548996354447?text=Quero%20comprar%20${encodeURIComponent(product.name)}" target="_blank" class="buyBtn">Comprar no WhatsApp</a>
            ${auth.currentUser && admins.includes(auth.currentUser.email) ? `<button onclick="removerProduto('${productId}')">Remover</button>` : ""}
          `;
          productsContainer.appendChild(productCard);
        });
      });
    }

    // Remover produto
    function removerProduto(id) {
      if (confirm("Deseja remover este produto?")) {
        db.ref("products/" + id).remove();
      }
    }
  </script>
</body>
</html>
