<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Blox Bux</title>
<link rel="stylesheet" href="style.css">
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-analytics.js";
import { 
  getAuth, 
  GoogleAuthProvider, 
  signInWithPopup, 
  onAuthStateChanged,
  signOut
} from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
import { 
  getFirestore, 
  collection, 
  getDocs, 
  addDoc 
} from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

// ===== CONFIG =====
const firebaseConfig = {
  apiKey: "AIzaSyC3wm5X7fBXjC8hUQv4sRdHS-v74KWIBC4",
  authDomain: "blox-bux.firebaseapp.com",
  databaseURL: "https://blox-bux-default-rtdb.firebaseio.com",
  projectId: "blox-bux",
  storageBucket: "blox-bux.appspot.com",
  messagingSenderId: "2964601609",
  appId: "1:2964601609:web:67ee85c8174825aee471d8",
  measurementId: "G-W2BW6GDCSY"
};

// ===== INICIALIZA =====
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
const auth = getAuth(app);
const db = getFirestore(app);
const provider = new GoogleAuthProvider();

// ===== LOGIN GOOGLE =====
document.getElementById("login-google").addEventListener("click", async () => {
  try { await signInWithPopup(auth, provider); } 
  catch (e) { alert("Erro Google: " + e.message); }
});

// ===== LOGOUT =====
document.getElementById("logout").addEventListener("click", async () => {
  await signOut(auth);
  document.getElementById("store-section").style.display = "block";
  document.getElementById("admin-section").style.display = "none";
});

// ===== MONITORAR LOGIN =====
onAuthStateChanged(auth, user => {
  if(user && user.email === "marymartins5821@gmail.com") {
    document.getElementById("admin-btn").style.display = "block";
  } else {
    document.getElementById("admin-btn").style.display = "none";
  }
});

// ===== CARREGAR PRODUTOS =====
async function carregarProdutos() {
  const lista = document.getElementById("products");
  lista.innerHTML = "";
  const snapshot = await getDocs(collection(db, "produtos"));
  snapshot.forEach(doc => {
    const produto = doc.data();
    lista.innerHTML += `
      <div class="product-card">
        <div class="product-info">
          <h3>${produto.nome}</h3>
          <p>R$ ${produto.preco}</p>
        </div>
        <a href="https://wa.me/5548996354447?text=Quero%20comprar%20${encodeURIComponent(produto.nome)}%20por%20R$${produto.preco}">
          <button class="buy-btn">Comprar</button>
        </a>
      </div>
    `;
  });
}
carregarProdutos();

// ===== ABRIR PAINEL ADMIN =====
document.getElementById("admin-btn").addEventListener("click", () => {
  document.getElementById("store-section").classList.add("fade-out");
  setTimeout(() => {
    document.getElementById("store-section").style.display = "none";
    document.getElementById("admin-section").style.display = "block";
    document.getElementById("admin-section").classList.add("fade-in");
  }, 300);
});

// ===== ADICIONAR PRODUTO =====
document.getElementById("product-form").addEventListener("submit", async (e) => {
  e.preventDefault();
  const nome = document.getElementById("product-name").value;
  const preco = document.getElementById("product-price").value;

  try {
    await addDoc(collection(db, "produtos"), { nome, preco });
    alert("Produto adicionado!");
    e.target.reset();
    carregarProdutos();
  } catch(e) { alert("Erro: "+e.message); }
});
</script>
</head>
<body>
<header>
  <h1>Blox Bux</h1>
  <div class="auth-buttons">
    <button id="login-google">Login com Google</button>
    <button id="logout">Sair</button>
  </div>
</header>

<!-- LOJA -->
<div id="store-section" class="container">
  <h2>Produtos</h2>
  <div id="products" class="product-list"></div>
</div>

<!-- BOTÃO ADMIN FLUTUANTE -->
<button id="admin-btn" style="display:none;">Admin</button>

<!-- PAINEL ADMIN -->
<div id="admin-section" class="container" style="display:none;">
  <h2>Painel Admin</h2>
  <form id="product-form">
    <input id="product-name" placeholder="Nome do Produto" required><br><br>
    <input id="product-price" type="number" placeholder="Preço" required><br><br>
    <button type="submit">Adicionar Produto</button>
  </form>
</div>
</body>
</html>
